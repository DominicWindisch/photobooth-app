"use strict";(globalThis["webpackChunkphotobooth_app_frontend"]=globalThis["webpackChunkphotobooth_app_frontend"]||[]).push([[176],{7176:(e,o,l)=>{l.r(o),l.d(o,{default:()=>S});var t=l(59835),r=l(86970);const n={class:"q-gutter-sm"},a={class:"q-mt-md row justify-center"},i={class:"col-12 col-md-8 q-mb-xl"},s={class:"col-12 col-md-8 q-mb-xl"};function c(e,o,l,c,u,m){const p=(0,t.up)("q-btn"),d=(0,t.up)("q-toolbar-title"),g=(0,t.up)("q-toolbar"),f=(0,t.up)("q-header"),_=(0,t.up)("q-item-section"),h=(0,t.up)("q-item"),b=(0,t.up)("q-list"),v=(0,t.up)("q-scroll-area"),w=(0,t.up)("q-drawer"),y=(0,t.up)("BlitzForm"),C=(0,t.up)("q-page"),k=(0,t.up)("q-page-container"),O=(0,t.up)("q-layout"),q=(0,t.Q2)("ripple");return(0,t.wg)(),(0,t.j4)(O,null,{default:(0,t.w5)((()=>[(0,t.Wm)(f,{style:{"z-index":"0"}},{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t.Wm)(p,{flat:"",onClick:o[0]||(o[0]=e=>c.drawer=!c.drawer),round:"",dense:"",icon:"menu"}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(c.group_title),1)])),_:1}),(0,t._)("div",n,[(0,t.Wm)(p,{label:e.$t("BTN_LABEL_RESET_CONFIG"),onClick:o[1]||(o[1]=e=>c.remoteProcedureCall("/admin/config/reset"))},null,8,["label"]),(0,t.Wm)(p,{label:e.$t("BTN_LABEL_RESTORE_CONFIG"),onClick:o[2]||(o[2]=e=>c.getConfig("current"))},null,8,["label"]),(0,t.Wm)(p,{color:"primary",label:e.$t("BTN_LABEL_PERSIST_CONFIG"),onClick:o[3]||(o[3]=e=>c.uploadConfigAndPersist())},null,8,["label"])])])),_:1})])),_:1}),(0,t.Wm)(w,{modelValue:c.drawer,"onUpdate:modelValue":o[4]||(o[4]=e=>c.drawer=e),width:300,breakpoint:500,bordered:"",class:(0,r.C_)(e.$q.dark.isActive?"bg-grey-9":"bg-grey-3")},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{class:"fit"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(c.main_groups,((o,l)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:l},[o.numChildren>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(o.numChildren,(l=>(0,t.wy)(((0,t.wg)(),(0,t.j4)(h,{key:l,clickable:"",active:o.path===e.$route.params.section&&l==e.$route.params.subSection,to:`/admin/config/${o.path}/${l}`,replace:""},{default:(0,t.w5)((()=>[(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(o.title)+" ("+(0,r.zw)(l)+") ",1)])),_:2},1024)])),_:2},1032,["active","to"])),[[q]]))),128)):(0,t.wy)(((0,t.wg)(),(0,t.j4)(h,{key:1,clickable:"",active:o.path===e.$route.params.section,to:`/admin/config/${o.path}`,replace:""},{default:(0,t.w5)((()=>[(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(o.title),1)])),_:2},1024)])),_:2},1032,["active","to"])),[[q]])],64)))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","class"]),(0,t.Wm)(k,null,{default:(0,t.w5)((()=>[(0,t.Wm)(C,{padding:""},{default:(0,t.w5)((()=>[(0,t._)("div",a,[(0,t._)("div",i,[(0,t._)("p",null,(0,r.zw)(c.group_description),1)]),(0,t._)("div",s,[c.selected_group_section?((0,t.wg)(),(0,t.iD)(t.HY,{key:0},[c.renderBlitzForm?((0,t.wg)(),(0,t.j4)(y,{modelValue:c.serverConfig[c.selected_group][c.selected_group_section-1],"onUpdate:modelValue":o[5]||(o[5]=e=>c.serverConfig[c.selected_group][c.selected_group_section-1]=e),key:`${c.selected_group}-${c.selected_group_section}`,schema:c.schema_blitzar,internalLabels:!1,"label-position":"left",class:"blitzar-form"},null,8,["modelValue","schema"])):(0,t.kq)("",!0)],64)):((0,t.wg)(),(0,t.iD)(t.HY,{key:1},[c.renderBlitzForm?((0,t.wg)(),(0,t.j4)(y,{modelValue:c.serverConfig[c.selected_group],"onUpdate:modelValue":o[6]||(o[6]=e=>c.serverConfig[c.selected_group]=e),key:c.selected_group,schema:c.schema_blitzar,internalLabels:!1,"label-position":"left",class:"blitzar-form"},null,8,["modelValue","schema"])):(0,t.kq)("",!0)],64))])])])),_:1})])),_:1})])),_:1})}l(72879);var u=l(60499),m=l(91569),p=l(19302),d=l(96694),g=l(32395);const f={components:{BlitzForm:g.lU,BlitzListForm:g.$C},created(){this.$watch((()=>this.$route.params),((e,o)=>{this.selected_group=e.section,this.selected_group_section=e.subSection}))},setup(){const e=(0,p.Z)(),o=(0,u.iH)({});let l={};const r=(0,u.iH)([]),n=(0,u.iH)(!1),a=(0,u.iH)(""),i=(0,u.iH)(""),s=(0,d.R)(),c=(0,t.Fl)((()=>""!=a.value?""!=i.value?`${l[a.value]["allOf"][0]["title"]} (Config ${i.value})`:l[a.value]["allOf"][0]["title"]:"-")),g=(0,t.Fl)((()=>""!=a.value?l[a.value]["allOf"][0]["description"]:"-")),f=(0,t.Fl)((()=>""!=a.value?_(l[a.value]):[])),_=e=>{const o=e=>e.replace(/[&<>'"]/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[e]))),l=(e,l)=>{let t={id:e,label:l["title"],component:"QInput",filled:!0};return"boolean"==l["type"]&&(t["component"]="QToggle"),"integer"!=l["type"]&&"float"!=l["type"]||(t["component"]="QInput",l["ui_component"]&&(t["component"]=l["ui_component"]),t["type"]="number",t["labelAlways"]=!0,l["exclusiveMinimum"]&&(t["min"]=l["exclusiveMinimum"]),l["exclusiveMaximum"]&&(t["max"]=l["exclusiveMaximum"]),l["minimum"]&&(t["min"]=l["minimum"]),l["maximum"]&&(t["max"]=l["maximum"])),"string"==l["type"]&&l["ui_component"]&&(t["component"]=l["ui_component"]),l["allOf"]&&Object.keys(l["allOf"][0]).includes("enum")&&(t["component"]="QSelect",t["options"]=l["allOf"][0]["enum"]),t["subLabel"]=`${l["description"]||""} (default=${o(("default"in l?l["default"]:"undefined").toString())})`,t},t=e=>{const[o,t]=e;let n=l(o,t);"array"==t["type"]&&t["items"]&&"object"==t["items"]["type"]?(n["component"]="BlitzListForm",n["schema"]=[],Object.entries(t["items"]["properties"]).forEach((e=>{const[o,t]=e;n["schema"].push(l(o,t))}))):"array"==t["type"]&&t["items"]&&t["items"]["enum"]&&"string"==t["items"]["type"]&&(n["component"]="QSelect",n["multiple"]=!0,n["use-chips"]=!0,n["stack-label"]=!0,n["options"]=t["items"]["enum"]),r.push(n)};console.log("creating blitzar schema"),console.log(e);let r=[];return"allOf"in e&&"properties"in e["allOf"][0]?Object.entries(e["allOf"][0]["properties"]).forEach((e=>t(e))):"allOf"in e&&"items"in e["allOf"][0]?Object.entries(e["allOf"][0]["items"]["properties"]).forEach((e=>t(e))):console.log("error, wrong format!, no direct props on main level"),console.log(r),r},h=()=>{m.api.get("/admin/config/schema?schema_type=dereferenced").then((async e=>{console.log("Response data:",e.data),l=e.data.properties,console.log("Schema dereferenced:",l),r.value=[];for(const[o,t]of Object.entries(l)){let e="items"in t["allOf"][0]?t["default"].length:0,l={path:o,title:t["allOf"][0]["title"],numChildren:e};r.value.push(l)}a.value=r.value[0].path})).catch((o=>{console.log(o),console.log("error"),e.notify({message:"error getting scheme! check logs",color:"red"})}))},b=(l="current")=>{n.value=!1,m.api.get(`/admin/config/${l}`).then((async e=>{console.log("Response data for ",l,": ",e.data),console.log("Server config for ",l,": ",o.value),o.value=e.data,n.value=!0})).catch((o=>{console.log(o),console.log("error"),e.notify({message:"error getting config!",color:"red"})}))};h(),b("currentActive");const v=()=>{console.log("sync config to server"),console.log(o.value),m.api.post("/admin/config/current",o.value).then((o=>{s.initStore(!0),e.notify({message:"Config persisted and reloaded from server. If changed hardware settings, pls reload/restart services!",color:"green"})})).catch((o=>{if(o.response){let l="check following fields:<br/>";return Object.values(o.response.data.detail).forEach((e=>{l+=e["loc"].join(" -> "),l+=`: ${e["msg"]}`,l+="<br/>"})),void e.notify({caption:"validation error",icon:"error",html:!0,message:`${l}`,color:"red"})}o.request?console.error(o.request):console.error("Error",o.message),e.notify({message:"error saving config, check browser console and logs",color:"red"})}))};return(0,t.wF)((()=>console.log("Composition API beforemounted"))),(0,t.bv)((()=>console.log("Composition API mounted"))),{drawer:(0,u.iH)(!0),schema_blitzar:f,renderBlitzForm:n,main_groups:r,group_title:c,group_description:g,selected_group:a,selected_group_section:i,serverConfig:o,remoteProcedureCall:m.remoteProcedureCall,getConfig:b,uploadConfigAndPersist:v}}};var _=l(11639),h=l(20249),b=l(16602),v=l(51663),w=l(68879),y=l(81973),C=l(10906),k=l(66663),O=l(13246),q=l(490),$=l(76749),z=l(12133),Q=l(69885),Z=l(51722),j=l(69984),B=l.n(j);const F=(0,_.Z)(f,[["render",c]]),S=F;B()(f,"components",{QLayout:h.Z,QHeader:b.Z,QToolbar:v.Z,QBtn:w.Z,QToolbarTitle:y.Z,QDrawer:C.Z,QScrollArea:k.Z,QList:O.Z,QItem:q.Z,QItemSection:$.Z,QPageContainer:z.Z,QPage:Q.Z}),B()(f,"directives",{Ripple:Z.Z})}}]);