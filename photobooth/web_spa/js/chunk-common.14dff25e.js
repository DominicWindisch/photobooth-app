"use strict";(globalThis["webpackChunkphotobooth_app_frontend"]=globalThis["webpackChunkphotobooth_app_frontend"]||[]).push([[64],{50227:(e,t,i)=>{i.d(t,{Z:()=>G});var l=i(59835),r=i(86970);const a={class:"q-ml-sm"},s={key:4,class:"q-mr-sm"},o={key:6,class:"q-mr-sm"},n={class:"text-subtitle2"},d={key:0,class:"full-height"},c={key:0,class:"full-height"},u=["src"],m={key:1,class:"full-height"},g=["src"],p={key:1,class:"full-height"},h={key:0,class:"full-height"},y=["src"],w={key:1,class:"full-height"},_=["src"];function f(e,t,i,f,S,v){const b=(0,l.up)("q-btn"),q=(0,l.up)("q-space"),k=(0,l.up)("q-avatar"),I=(0,l.up)("q-card-section"),L=(0,l.up)("q-card-actions"),x=(0,l.up)("q-card"),T=(0,l.up)("q-dialog"),R=(0,l.up)("q-icon"),E=(0,l.up)("q-toolbar"),D=(0,l.up)("q-linear-progress"),Z=(0,l.up)("q-header"),C=(0,l.up)("q-img"),A=(0,l.up)("q-drawer"),Q=(0,l.up)("q-carousel-slide"),W=(0,l.up)("q-carousel"),$=(0,l.up)("vue-qrcode"),j=(0,l.up)("q-page-sticky"),B=(0,l.up)("q-page-container"),N=(0,l.up)("q-layout"),z=(0,l.Q2)("close-popup"),F=(0,l.Q2)("touch-swipe");return v.emptyRepository?((0,l.wg)(),(0,l.j4)(N,{key:1,view:"hhh Lpr ffr"},{default:(0,l.w5)((()=>[(0,l.Uk)("EMPTY")])),_:1})):((0,l.wg)(),(0,l.j4)(N,{key:0,view:"hhh Lpr ffr",onClick:v.abortTimer},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,{elevated:"",class:"bg-primary text-white"},{default:(0,l.w5)((()=>[i.showToolbar?((0,l.wg)(),(0,l.j4)(E,{key:0,class:"toolbar",id:"gallery-toolbar"},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{dense:"",flat:"",icon:"close",size:"1.5rem",onClick:t[0]||(t[0]=t=>e.$emit("closeEvent"))}),(0,l.Wm)(q),f.uiSettingsStore.uiSettings.gallery_show_delete||i.singleItemView?((0,l.wg)(),(0,l.j4)(b,{key:0,flat:"",class:"q-mr-sm",icon:"delete",label:e.$t("BTN_LABEL_GALLERY_DELETE"),onClick:t[1]||(t[1]=e=>f.confirmDeleteFile=!0)},null,8,["label"])):(0,l.kq)("",!0),(0,l.Wm)(T,{modelValue:f.confirmDeleteFile,"onUpdate:modelValue":t[3]||(t[3]=e=>f.confirmDeleteFile=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{class:"q-pa-sm",style:{"min-width":"350px"},id:"gallery-confirm-delete-dialog"},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{class:"row items-center"},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{icon:"delete",color:"primary","text-color":"white"}),(0,l._)("span",a,(0,r.zw)(e.$t("MSG_CONFIRM_DELETE_IMAGE")),1)])),_:1}),(0,l.Wm)(L,{align:"right"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(b,{flat:"",label:e.$t("BTN_LABEL_CANCEL")},null,8,["label"]),[[z]]),(0,l.wy)((0,l.Wm)(b,{label:e.$t("BTN_LABEL_DELETE_IMAGE"),color:"primary",onClick:t[2]||(t[2]=t=>{v.deleteItem(f.currentSlideId),e.$emit("closeEvent")})},null,8,["label"]),[[z]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),f.uiSettingsStore.uiSettings.gallery_show_download?((0,l.wg)(),(0,l.j4)(b,{key:1,flat:"",class:"q-mr-sm",icon:"download",label:e.$t("BTN_LABEL_GALLERY_DOWNLOAD"),onClick:t[4]||(t[4]=e=>{f.openURL(i.itemRepository[f.currentSlideIndex]["full"])})},null,8,["label"])):(0,l.kq)("",!0),f.uiSettingsStore.uiSettings.gallery_show_print?((0,l.wg)(),(0,l.j4)(b,{key:2,flat:"",class:"q-mr-sm",icon:"print",label:e.$t("BTN_LABEL_GALLERY_PRINT"),onClick:t[5]||(t[5]=e=>v.printItem(f.currentSlideId))},null,8,["label"])):(0,l.kq)("",!0),f.uiSettingsStore.uiSettings.gallery_show_filter&&f.uiSettingsStore.uiSettings.gallery_filter_userselectable.length>0?((0,l.wg)(),(0,l.j4)(b,{key:3,flat:"",class:"q-mr-sm",icon:"filter",label:e.$t("BTN_LABEL_GALLERY_FILTER"),disabled:!v.getFilterAvailable(i.itemRepository[f.currentSlideIndex]["media_type"]),onClick:f.toggleRightDrawer},null,8,["label","disabled","onClick"])):(0,l.kq)("",!0),(0,l.Wm)(q),!i.singleItemView&&f.uiSettingsStore.uiSettings.gallery_show_image_number?((0,l.wg)(),(0,l.iD)("div",s,[(0,l.Wm)(R,{name:"tag"}),(0,l._)("span",null,(0,r.zw)(f.currentSlideIndex+1)+" / "+(0,r.zw)(i.itemRepository.length),1)])):(0,l.kq)("",!0),f.uiSettingsStore.uiSettings.gallery_show_file_name?((0,l.wg)(),(0,l.j4)(q,{key:5})):(0,l.kq)("",!0),f.uiSettingsStore.uiSettings.gallery_show_file_name?((0,l.wg)(),(0,l.iD)("div",o,[(0,l.Wm)(R,{name:"image"}),(0,l.Uk)(" "+(0,r.zw)(i.itemRepository[f.currentSlideIndex]["caption"]),1)])):(0,l.kq)("",!0)])),_:1})):(0,l.kq)("",!0),S.displayLinearProgressBar&&S.remainingSeconds>0?((0,l.wg)(),(0,l.j4)(D,{key:1,class:"absolute",value:S.remainingSecondsNormalized,"animation-speed":"200",color:"grey",id:"gallery-linear-progress-bar"},null,8,["value"])):(0,l.kq)("",!0),f.displayLoadingSpinner?((0,l.wg)(),(0,l.j4)(D,{key:2,class:"absolute",indeterminate:"","animation-speed":"2100",color:"primary"})):(0,l.kq)("",!0)])),_:1}),f.uiSettingsStore.uiSettings.gallery_show_filter&&v.getFilterAvailable(i.itemRepository[f.currentSlideIndex]["media_type"])&&i.showToolbar?((0,l.wg)(),(0,l.j4)(A,{key:0,class:"q-pa-sm",modelValue:f.rightDrawerOpen,"onUpdate:modelValue":t[6]||(t[6]=e=>f.rightDrawerOpen=e),side:"right",overlay:"",id:"gallery-drawer-filters"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(f.uiSettingsStore.uiSettings.gallery_filter_userselectable,(e=>((0,l.wg)(),(0,l.j4)(x,{class:"q-mb-sm",key:e},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{class:"q-pa-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{class:"rounded-borders",loading:"lazy",onClick:t=>v.applyFilter(f.currentSlideId,e),src:`/mediaprocessing/preview/${f.currentSlideId}/${e}`},null,8,["onClick","src"])])),_:2},1024),(0,l.Wm)(I,{class:"q-pa-none q-pb-sm",align:"center"},{default:(0,l.w5)((()=>[(0,l._)("div",n,(0,r.zw)(e),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["modelValue"])):(0,l.kq)("",!0),(0,l.Wm)(B,{class:"q-pa-none galleryimagedetail full-height"},{default:(0,l.w5)((()=>[i.singleItemView?((0,l.wg)(),(0,l.iD)("div",d,[(0,l.Wm)(x,{class:"column no-wrap flex-center full-height q-pa-sm"},{default:(0,l.w5)((()=>["video"!=this.itemRepository[0].media_type?((0,l.wg)(),(0,l.iD)("div",c,[(0,l._)("img",{draggable:!1,class:"rounded-borders full-height",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},src:this.itemRepository[0].preview},null,8,u)])):((0,l.wg)(),(0,l.iD)("div",m,[(0,l._)("video",{draggable:!1,src:this.itemRepository[0].preview,class:"rounded-borders full-height",muted:"",autoplay:"",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},controls:"controls"},null,8,g)]))])),_:1})])):((0,l.wg)(),(0,l.iD)("div",p,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(W,{class:"",style:{width:"100%",height:"100%"},"control-type":"flat","control-color":"primary",swipeable:"",animated:"",modelValue:f.currentSlideId,"onUpdate:modelValue":t[7]||(t[7]=e=>f.currentSlideId=e),autoplay:i.slideshowTimeout,draggable:"false",arrows:"",infinite:"","transition-prev":i.slideshowUseFade?"fade":"slide-right","transition-next":i.slideshowUseFade?"fade":"slide-left",onTransition:t[8]||(t[8]=(e,t)=>{f.currentSlideIndex=i.itemRepository.findIndex((t=>t.id===e)),v.abortTimer()})},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(v.slicedImages,(e=>((0,l.wg)(),(0,l.j4)(Q,{key:e.id,name:e.id,class:"column no-wrap flex-center full-height q-pa-sm"},{default:(0,l.w5)((()=>["video"!=e.media_type?((0,l.wg)(),(0,l.iD)("div",h,[(0,l._)("img",{draggable:!1,class:"rounded-borders full-height",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},src:e.preview},null,8,y)])):((0,l.wg)(),(0,l.iD)("div",w,[(0,l._)("video",{draggable:!1,src:e.preview,class:"rounded-borders full-height",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},controls:"controls"},null,8,_)]))])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue","autoplay","transition-prev","transition-next"])),[[F,f.handleSwipeDown,void 0,{mouse:!0,down:!0}]])])),f.uiSettingsStore.uiSettings.gallery_show_qrcode&&i.showToolbar?((0,l.wg)(),(0,l.j4)(j,{key:2,position:"top-right",offset:[30,30]},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)($,{type:"image/png",tag:"svg",margin:2,width:200,"error-correction-level":"low",color:{dark:"#111111",light:"#EEEEEE"},value:v.getImageQrData()},null,8,["value"])])])),_:1})):(0,l.kq)("",!0)])),_:1})])),_:1},8,["onClick"]))}i(72879);var S=i(44556),v=i(60499),b=i(96694),q=i(33752),k=i(19302);const I={props:{indexSelected:{type:Number,required:!0},itemRepository:{type:Array,required:!0},startTimerOnOpen:{type:Boolean,required:!1,default:!1},singleItemView:{type:Boolean,default:!1},showToolbar:{type:Boolean,default:!0},slideshowTimeout:{type:Number,default:0},slideshowUseFade:{type:Boolean,default:!1}},computed:{emptyRepository(){return!this.itemRepository||0==this.itemRepository.length},slicedImages(){console.log("changed");this.itemRepository.length;var e=Math.max(0,this.currentSlideIndex-2),t=Math.max(0,this.currentSlideIndex+3);return console.log(this.itemRepository.slice(e,t)),this.itemRepository.slice(e,t)}},beforeCreate(){console.log(this.indexSelected),this.currentSlideIndex=this.indexSelected,this.currentSlideId=this.itemRepository[this.indexSelected].id},data(){return{intervalTimerId:null,remainingSeconds:0,remainingSecondsNormalized:0,displayLinearProgressBar:!0}},setup(){const e=(0,b.R)(),t=(0,v.iH)(!1);(0,k.Z)();return{uiSettingsStore:e,openURL:q.Z,fabRight:(0,v.iH)(!1),currentSlideId:(0,v.iH)(""),currentSlideIndex:(0,v.iH)(0),autoplay:(0,v.iH)(!1),showFilterDialog:(0,v.iH)(!1),displayLoadingSpinner:(0,v.iH)(!1),confirmDeleteFile:(0,v.iH)(!1),rightDrawerOpen:t,toggleRightDrawer(){t.value=!t.value},handleSwipeDown({evt:e}){console.log("TODO: add method to close dialog programmatically")}}},components:{VueQrcode:S.ZP},mounted(){this.startTimerOnOpen&&this.startTimer()},beforeUnmount(){clearInterval(this.intervalTimerId)},methods:{async reloadImg(e){await fetch(e,{cache:"reload",mode:"no-cors"});const t=(new Date).getTime();document.body.querySelectorAll(`img[src*='${e}']`).forEach((i=>{i.src=e+"#"+t}))},applyFilter(e,t){this.displayLoadingSpinner=!0,this.$api.get(`/mediaprocessing/applyfilter/${e}/${t}`).then((t=>{const i=this.itemRepository.findIndex((t=>t.id===e));this.reloadImg(this.itemRepository[i].full),this.reloadImg(this.itemRepository[i].preview),this.reloadImg(this.itemRepository[i].thumbnail),this.displayLoadingSpinner=!1})).catch((e=>{console.log(e),this.displayLoadingSpinner=!1}))},deleteItem(e){this.$api.get("/mediacollection/delete",{params:{image_id:e}}).then((e=>{console.log(e)})).catch((e=>console.log(e)))},printItem(e){this.$api.get(`/print/item/${e}`).then((e=>{console.log(e),this.$q.notify({message:"Started printing...",type:"positive",spinner:!0})})).catch((e=>{e.response?(console.log(e.response),425==e.response.status?this.$q.notify({message:e.response.data["detail"],caption:"Print Service",type:"info"}):this.$q.notify({message:e.response.data["detail"],caption:"Print Service",type:"negative"})):e.request?console.error(e.request):console.error("Error",e.message)}))},getFilterAvailable(e){return["image","collageimage","animationimage"].includes(e)},getImageQrData(){return this.itemRepository[this.currentSlideIndex]["share_url"]},abortTimer(){clearInterval(this.intervalTimerId),this.remainingSeconds=0,this.remainingSecondsNormalized=0},startTimer(){var e=this.uiSettingsStore.uiSettings["AUTOCLOSE_NEW_ITEM_ARRIVED"];console.log(`starting newitemarrived timer, duration=${e}`),this.remainingSeconds=e,this.intervalTimerId=setInterval((()=>{this.remainingSecondsNormalized=this.remainingSeconds/e,this.remainingSeconds-=.05,this.remainingSeconds<=0&&(clearInterval(this.intervalTimerId),this.$router.push({path:"/"}))}),50)}}};var L=i(11639),x=i(20249),T=i(16602),R=i(51663),E=i(68879),D=i(90136),Z=i(32074),C=i(44458),A=i(63190),Q=i(61357),W=i(11821),$=i(22857),j=i(8289),B=i(10906),N=i(70335),z=i(12133),F=i(97052),V=i(41694),O=i(30627),P=i(62146),U=i(64871),H=i(69984),M=i.n(H);const Y=(0,L.Z)(I,[["render",f]]),G=Y;M()(I,"components",{QLayout:x.Z,QHeader:T.Z,QToolbar:R.Z,QBtn:E.Z,QSpace:D.Z,QDialog:Z.Z,QCard:C.Z,QCardSection:A.Z,QAvatar:Q.Z,QCardActions:W.Z,QIcon:$.Z,QLinearProgress:j.Z,QDrawer:B.Z,QImg:N.Z,QPageContainer:z.Z,QCarousel:F.Z,QCarouselSlide:V.Z,QPageSticky:O.Z}),M()(I,"directives",{ClosePopup:P.Z,TouchSwipe:U.Z})},1210:(e,t,i)=>{i.d(t,{Z:()=>_});i(72879);var l=i(59835),r=i(86970),a=i(46038),s=i(28339);const o={key:0},n=(0,l._)("div",{class:"fullscreen bg-secondary",style:{"z-index":"98",opacity:"0.5"}},null,-1),d={class:"q-ml-sm"},c={__name:"RouteAfterTimeout",props:{route:{type:String,required:!0},timeout_ms:{type:Number,required:!0},warning_message:{type:String,default:"Auto-starting slideshow... Click anywhere to stay on this page."},warning_time_ms:{type:Number,default:1e4}},setup(e){const t=(0,s.tv)(),i=e,{idle:c,lastActive:u,reset:m}=(0,a.c3l)(i.timeout_ms),g=(0,a.Z93)({interval:1e3}),p=(0,l.Fl)((()=>i.timeout_ms-(g.value-u.value))),h=(0,l.Fl)((()=>i.warning_time_ms>p.value));return(0,l.YP)(c,(e=>{e&&(m(),t.push({path:i.route}))})),(t,i)=>{const a=(0,l.up)("q-avatar"),s=(0,l.up)("q-card-section"),c=(0,l.up)("q-linear-progress"),u=(0,l.up)("q-card");return h.value?((0,l.wg)(),(0,l.iD)("div",o,[n,(0,l.Wm)(u,{class:"q-pa-sm fixed-center text-h3",style:{"border-radius":"10px","z-index":"99"},id:"router-warn-auto-route-dialog"},{default:(0,l.w5)((()=>[(0,l.Wm)(s,{horizontal:""},{default:(0,l.w5)((()=>[(0,l.Wm)(a,{icon:"warning",color:"primary",style:{"font-size":"7vh"}}),(0,l._)("div",d,(0,r.zw)(e.warning_message),1)])),_:1}),(0,l.Wm)(s,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{class:"absolute",value:p.value/e.warning_time_ms,"animation-speed":"200",color:"secondary",id:"router-linear-progress-bar",size:"1vh"},null,8,["value"])])),_:1})])),_:1})])):(0,l.kq)("",!0)}}};var u=i(44458),m=i(63190),g=i(61357),p=i(8289),h=i(69984),y=i.n(h);const w=c,_=w;y()(c,"components",{QCard:u.Z,QCardSection:m.Z,QAvatar:g.Z,QLinearProgress:p.Z})}}]);